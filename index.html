<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üåà Firebase Login Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .box {
      max-width: 800px;
      margin: auto;
      background: #222;
      padding: 20px;
      border-radius: 10px;
    }
    input, button {
      padding: 8px;
      margin: 5px;
      border-radius: 6px;
      border: none;
      font-family: monospace;
    }
    button {
      background: #0ff;
      color: #000;
      cursor: pointer;
    }
    .danger { background: red; color: white; }
    ul { padding-left: 20px; }
    li { margin-bottom: 5px; }
  </style>
</head>
<body>

<div class="box" id="loginBox">
  <h2>üîê Login</h2>
  <input id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
  <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button onclick="login()">Login</button>
</div>

<div class="box" id="mainApp" style="display:none;">
  <h3>‚úÖ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö: <span id="userDisplay"></span></h3>
  <div id="adminOnly" style="display:none;">
    <h4>üü¢ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h4>
    <ul id="userList"></ul>

    <h4>ü¶∂ ‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÉ‡∏™‡πà IP):</h4>
    <input id="kickIP" placeholder="IP ‡πÄ‡∏ä‡πà‡∏ô 1.2.3.4">
    <button onclick="kickByIP()">‡πÄ‡∏ï‡∏∞</button>

    <h4>üö´ ‡πÅ‡∏ö‡∏ô IP:</h4>
    <input id="banIP" placeholder="IP ‡πÄ‡∏ä‡πà‡∏ô 1.2.3.4">
    <button onclick="banIP()">‡πÅ‡∏ö‡∏ô</button>

    <h4>‚úÖ ‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô IP:</h4>
    <input id="unbanIP" placeholder="IP ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô">
    <button onclick="unbanIP()">‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô</button>

    <h4>üîÅ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô/‡πÄ‡∏ï‡∏∞</h4>
    <button onclick="loadAdminData()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>

    <h4>üìã ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
    <ul id="allUsersList"></ul>
  </div>
  <button onclick="logout()" class="danger">Logout</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD40kcFdCmRm6Zd_kTpU9lT1-HLmStzYhA",
  authDomain: "symic-d7196.firebaseapp.com",
  databaseURL: "https://symic-d7196-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "symic-d7196",
  storageBucket: "symic-d7196.appspot.com",
  messagingSenderId: "835880076541",
  appId: "1:835880076541:web:4a6816fb52ff91ae1c2a94"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ADMIN_PASS = "pik";
let currentUser = null;
let currentIP = null;

function sanitize(str) {
  return str.replace(/[.#$[\]]/g, "_");
}

async function getIP() {
  try {
    const res = await fetch("https://www.cloudflare.com/cdn-cgi/trace");
    const txt = await res.text();
    return txt.match(/ip=([^\n]+)/)?.[1] || "unknown";
  } catch {
    return "unknown";
  }
}

function getUA() {
  const ua = navigator.userAgent;
  if (/iPhone/i.test(ua)) return "iPhone";
  if (/Android/i.test(ua)) return "Android";
  return ua;
}

async function login() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  if (!u || !p) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

  const snap = await db.ref("users/" + sanitize(u)).get();
  if (!snap.exists() || snap.val() !== p) return alert("‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");

  currentIP = await getIP();
  const ua = getUA();

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏ö‡∏ô
  const banned = await db.ref("bannedIPs/" + sanitize(currentIP)).get();
  if (banned.exists()) return alert("IP ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô");

  currentUser = u;
  localStorage.setItem("user", u);
  localStorage.setItem("time", Date.now());

  await db.ref("activeUsers/" + sanitize(u)).set({
    ip: currentIP,
    ua: ua,
    time: Date.now(),
    kicked: false
  });

  document.getElementById("userDisplay").textContent = u;
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("mainApp").style.display = "block";

  if (p === ADMIN_PASS) {
    document.getElementById("adminOnly").style.display = "block";
    loadAdminData();
  }

  // ‡πÄ‡∏ï‡∏∞‡∏ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å flag
  db.ref("activeUsers/" + sanitize(u) + "/kicked").on("value", snap => {
    if (snap.val() === true) {
      alert("‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏∞‡∏≠‡∏≠‡∏Å!");
      logout();
    }
  });
}

function logout() {
  if (currentUser) {
    db.ref("activeUsers/" + sanitize(currentUser)).remove();
    currentUser = null;
    localStorage.clear();
  }
  document.getElementById("mainApp").style.display = "none";
  document.getElementById("loginBox").style.display = "block";
}

function kickByIP() {
  const ip = document.getElementById("kickIP").value.trim();
  if (!ip) return alert("‡∏Å‡∏£‡∏≠‡∏Å IP");

  db.ref("activeUsers").once("value", snap => {
    snap.forEach(c => {
      const v = c.val();
      if (v.ip === ip && c.key !== sanitize("admin")) {
        db.ref("activeUsers/" + c.key + "/kicked").set(true);
      }
    });
    alert("‡πÄ‡∏ï‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  });
}

function banIP() {
  const ip = document.getElementById("banIP").value.trim();
  if (!ip) return alert("‡πÉ‡∏™‡πà IP");

  if (ip === currentIP && currentUser === "admin") {
    return alert("‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ö‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á!");
  }

  db.ref("bannedIPs/" + sanitize(ip)).set(true);
  alert("‡πÅ‡∏ö‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}

function unbanIP() {
  const ip = document.getElementById("unbanIP").value.trim();
  if (!ip) return alert("‡πÉ‡∏™‡πà IP");

  db.ref("bannedIPs/" + sanitize(ip)).remove();
  alert("‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
}

function loadAdminData() {
  db.ref("activeUsers").once("value", snap => {
    const ul = document.getElementById("userList");
    ul.innerHTML = "";
    snap.forEach(c => {
      const v = c.val();
      ul.innerHTML += `<li>${c.key} ‚Ä¢ ${v.ip || "?"} ‚Ä¢ ${v.ua || "?"}</li>`;
    });
  });

  db.ref("users").once("value", snap => {
    const ul = document.getElementById("allUsersList");
    ul.innerHTML = "";
    snap.forEach(c => {
      ul.innerHTML += `<li>${c.key}</li>`;
    });
  });
}

window.onload = async () => {
  const u = localStorage.getItem("user");
  const t = parseInt(localStorage.getItem("time") || "0");
  if (u && Date.now() - t < 7 * 24 * 60 * 60 * 1000) {
    document.getElementById("username").value = u;
    const snap = await db.ref("users/" + sanitize(u)).get();
    if (snap.exists()) {
      document.getElementById("password").value = snap.val();
      login();
    }
  }
};

window.addEventListener("beforeunload", () => {
  if (currentUser) db.ref("activeUsers/" + sanitize(currentUser)).remove();
});
</script>
</body>
</html>
